!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e["jsonapi-svelte-form"]={})}(this,(function(e){const{get:t,set:a,del:d}=require("pointer-props"),i=require("just-diff"),{diff:n}=i,r=e=>JSON.parse(JSON.stringify(e));e.formFromResponse=e=>{const t={},a={};if(t[e.data.id]=e.data,a[e.data.id]=r(e.data),e.included)for(const d of e.included)t[d.id]=d,a[d.id]=r(d);return{data:t,original:a,changes:{}}},e.onFormChange=(e,{detail:{id:t,keypath:i,value:r}})=>{const o=["data",t,...i];return void 0!==r?a(e,o,r):d(e,o),e.changes[t]=n(e.original[t]||{},e.data[t]||{}),e},e.removeResource=function(e,{detail:{id:t,type:a}}){delete e.data[t],e.changes[t]=n(e.original[t]||{},e.data[t]||{});for(let d in e.data){let i=e.data[d];for(let e of Object.keys(i.relationships||{})){const d=i.relationships[e];Array.isArray(d.data)?(d.data=d.data.filter((e=>e.id!==t||e.type!==a)),d.data.length||delete d.data):d?.data?.id===t&&d?.data?.type===a&&delete d.data,d.data||delete i.relationships[e]}Object.keys(i.relationships||{}).length||delete i.relationships,e.changes[d]=n(e.original[d]||{},e.data[d]||{}),e.changes[d].length||delete e.changes[d]}return e},e.resourceCreator=(e=0)=>{let d=e;return(e,{detail:{relatedId:i,relatedName:r,isArray:o,type:s}})=>{let l="GID"+ ++d;e.data[l]={type:s,id:l};let p=[i,"relationships",r,"data"];return a(e.data,p,o?[...t(e.data,p)||[],{type:s,id:l}]:{type:s,id:l}),e.changes[l]=n({},e.data[l]),e.changes[l].length||delete e.changes[l],e}}}));